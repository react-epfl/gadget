<?xml version="1.0" encoding="UTF-8"?>
<Module>
<ModulePrefs title="Add activity"
                author_email="aubry.cholleton@epfl.ch"
                author="Aubry Cholleton"
                description="Add a new activity from a gadget">
    <Require feature="opensocial-0.9"/>
    <Require feature="osapi"/>
    <Require feature="dynamic-height"/>
</ModulePrefs>
<Content type="html"><![CDATA[
<style> 
body {
  background-color: transparent;
}
</style>

<script class="include" language="javascript" type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

<script type="text/javascript">



function addActivity(){
gadgets.window.adjustHeight();
  $(".button").click(function() {  
    var params = {
      userId: '@viewer',
      groupId: '@self',
      activity: {
        actor: {
          id: $("#actor_id").val(),
          objectType: "User"
        },
        verb: $("#verb").val(),
        object: {
          id: $("#object_id").val(),
          objectType: $("#object_type").val()
        }
      }
    };

    if($("#use_target").is(':checked')) {
      params.activity.target = {
        id: $("#target_id").val(),
        objectType: $("#target_type").val()
      };
    }
    alert("Summary of the activity you are about to create : \n"+JSON.stringify(params.activity, null, 4));

    
    osapi.activitystreams.create(params).execute(function(response){
      $("#activity").append("<br/>New activity created successfully ! New ID : "+response.id);
      gadgets.window.adjustHeight();
    });  
  });  
    

}


function init()
{
  addActivity(); 
}

gadgets.util.registerOnLoadHandler(init);

</script>
<div id="form">
  <form id="add" action="">
    <label for="verb">Verb :</label>
    <select name="verb" id="verb">
      <option value="access">Visit</option>
      <option value="add">Add</option>
      <option value="update">Update</option>
      <option value="invite">Invite</option>
      <option value="invite-remind">Send invitation reminder</option>
      <option value="request-join">Join request</option>
      <option value="join"  selected="selected">Join</option>
      <option value="remove">Remove</option>
      <option value="delete">Delete</option>
    </select>
    <fieldset id="actor">
      <legend>Actor</legend>
      <label for="actorid">Id : </label>
      <input type="number" name="actor_id" id="actor_id" min="1" max="999999" value="887">
    </fieldset>

    <fieldset id="object">
      <legend>Object</legend>
      <label for="objectid">Id : </label>
      <input type="number" name="object_id" id="object_id" min="1" max="999999" value="1279">
      <label for="objecttype">Type </label>
      <select name="object_type" id="object_type">
        <option value="User">User</option>
        <option value="Space"  selected="selected">Space</option>
        <option value="Asset">Asset</option>
        <option value="Link">Link</option>
        <option value="Rating">Rating</option>
        <option value="Tagging">Tagging</option>
        <option value="Comment">Comment</option>
        <option value="Widget">Widget</option>
        <option value="Favorite">Favorite</option>
      </select>
    </fieldset>

    <fieldset id="target">
      <legend>Target</legend>
      <label for="use_target">Use target ? </label>
      <input type="checkbox" name="use_target" id="use_target"/>
      <label for="targetid">Id : </label>
      <input type="number" name="target_id" id="target_id" min="1" max="999999">
      <label for="targettype">Type </label>
      <select name="target_type" id="target_type">
        <option value="User" selected="selected">User</option>
        <option value="Space">Space</option>
        <option value="Asset">Asset</option>
        <option value="Link">Link</option>
        <option value="Rating">Rating</option>
        <option value="Tagging">Tagging</option>
        <option value="Comment">Comment</option>
        <option value="Widget">Widget</option>
        <option value="Favorite">Favorite</option>
      </select>
    </fieldset>
    <input type="button" name="submit" class="button" id="create" value="Create activity !" />
  </form>
</div>
<div id="activity"></div>
<div id = "note"><br />This example uses the old system, on the new one it is possible to specify a generator, to define objects manually (specify every fields), to reference external objects etc ...</div>

]]></Content>
</Module>