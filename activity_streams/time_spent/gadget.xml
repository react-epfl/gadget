<?xml version="1.0" encoding="UTF-8"?>
<Module>
<ModulePrefs title="Time spent in phases"
                author_email="david.sandoz@epfl.ch"
                author="David Sandoz"
                description="Shows the time spent in each phase of an ILS for each user and in average">
    <Require feature="opensocial-0.9"/>
    <Require feature="osapi"/>
    <Require feature="dynamic-height"/>
</ModulePrefs>
<Content type="html"><![CDATA[
  <html ng-app="timeSpentGadget">
  <head>
    <title>Time spent in phases</title>

    <link rel="stylesheet" type="text/css" href="time_spent.css" />

    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/headjs/1.0.3/head.min.js"></script>
    <script type="text/javascript">
      var pathToGadget = "http://graasp.epfl.ch/gadget/activity_streams/time_spent/";
      head.load("http://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.js",
        "http://graasp.epfl.ch/gadget/libs/jquery.cookie.js",
        "http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.0/angular.js",
        "http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.0/angular-resource.js",
        "http://cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.16/socket.io.min.js",
        "http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore.js",
        "http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js",
        "http://graasp.epfl.ch/ils_lib/main/ils_graaspeu.js",
        pathToGadget + "time_spent.module.js",
        pathToGadget + "time_spent.spaces.service.js",
        pathToGadget + "time_spent.controller.js",
        pathToGadget + "time_spent.backImg.directive.js");
    </script>
  </head>
  <body>
    <div ng-controller="timeSpentGadget" ng-init="init(); startTimer();">
      <div id="timeSpent" class="ng-cloak">
        <p ng-show="notInIlsMessage">{{notInIlsMessage}}</p>
        <!--<form novalidate>
          <label>Users are considered offline after</label>
          <input type="text" ng-model="minutes" />
          <label>minutes</label>
          <input type="submit" ng-click="setUsersTimeout()" value="Apply" />
        </form>-->
        <table ng-show="!notInIlsMessage">
          <tr>
            <th></th>
            <th ng-repeat="phase in phases">{{phase.name}}</th>
          </tr>
          <tr id ="averageTime">
            <th>Average time</th>
            <th ng-repeat="phase in phases">
              <span ng-show="phase.averageTime.hours() > 0">{{phase.averageTime.hours() | numberFixedLen:2}}:</span>{{phase.averageTime.minutes() | numberFixedLen:2}}:{{phase.averageTime.seconds() | numberFixedLen:2}}
            </th>
          </tr>
          <tr id="user-{{user.id}}" ng-repeat="user in users">
            <td class="userName">
              {{user.displayName | limitTo:14}}
            </td>
            <td ng-repeat="time in user.timeSpentIn">
              <span ng-show="time.hours() > 0">{{time.hours() | numberFixedLen:2}}:</span>{{time.minutes() | numberFixedLen:2}}:{{time.seconds() | numberFixedLen:2}}
            </td>
          </tr>
        </table>
      </div>
    </div>
    <script>
      head.ready(function () {
        //Scripts loaded
        gadgets.window.adjustHeight();
      });
    </script>
  </body>
  </html>
]]></Content>
</Module>
